#!/bin/bash
set -ex

export BASE=s3://mstar-data/cc100.txt.split.zst/
export SPLITS=(ar/ar.txt.000.zst ar/ar.txt.001.zst ar/ar.txt.002.zst ar/ar.txt.003.zst ar/ar.txt.004.zst ar/ar.txt.005.zst ar/ar.txt.006.zst ar/ar.txt.007.zst ar/ar.txt.008.zst ar/ar.txt.009.zst ar/ar.txt.010.zst ar/ar.txt.011.zst ar/ar.txt.012.zst ca/ca.txt.000.zst ca/ca.txt.001.zst ca/ca.txt.002.zst ca/ca.txt.003.zst ca/ca.txt.004.zst ca/ca.txt.005.zst ca/ca.txt.006.zst ca/ca.txt.007.zst de/de.txt.000.zst de/de.txt.001.zst de/de.txt.002.zst de/de.txt.003.zst de/de.txt.004.zst de/de.txt.005.zst de/de.txt.006.zst de/de.txt.007.zst de/de.txt.008.zst de/de.txt.009.zst de/de.txt.010.zst de/de.txt.011.zst de/de.txt.012.zst de/de.txt.013.zst de/de.txt.014.zst de/de.txt.015.zst de/de.txt.016.zst de/de.txt.017.zst de/de.txt.018.zst de/de.txt.019.zst de/de.txt.020.zst de/de.txt.021.zst de/de.txt.022.zst de/de.txt.023.zst de/de.txt.024.zst de/de.txt.025.zst de/de.txt.026.zst de/de.txt.027.zst de/de.txt.028.zst de/de.txt.029.zst de/de.txt.030.zst de/de.txt.031.zst de/de.txt.032.zst de/de.txt.033.zst de/de.txt.034.zst de/de.txt.035.zst de/de.txt.036.zst de/de.txt.037.zst de/de.txt.038.zst de/de.txt.039.zst de/de.txt.040.zst de/de.txt.041.zst en/en.txt.000.zst en/en.txt.001.zst en/en.txt.002.zst en/en.txt.003.zst en/en.txt.004.zst en/en.txt.005.zst en/en.txt.006.zst en/en.txt.007.zst en/en.txt.008.zst en/en.txt.009.zst en/en.txt.010.zst en/en.txt.011.zst en/en.txt.012.zst en/en.txt.013.zst en/en.txt.014.zst en/en.txt.015.zst en/en.txt.016.zst en/en.txt.017.zst en/en.txt.018.zst en/en.txt.019.zst en/en.txt.020.zst en/en.txt.021.zst en/en.txt.022.zst en/en.txt.023.zst en/en.txt.024.zst en/en.txt.025.zst en/en.txt.026.zst en/en.txt.027.zst en/en.txt.028.zst en/en.txt.029.zst en/en.txt.030.zst en/en.txt.031.zst en/en.txt.032.zst en/en.txt.033.zst en/en.txt.034.zst en/en.txt.035.zst en/en.txt.036.zst en/en.txt.037.zst en/en.txt.038.zst en/en.txt.039.zst en/en.txt.040.zst en/en.txt.041.zst en/en.txt.042.zst en/en.txt.043.zst en/en.txt.044.zst en/en.txt.045.zst en/en.txt.046.zst en/en.txt.047.zst en/en.txt.048.zst en/en.txt.049.zst en/en.txt.050.zst en/en.txt.051.zst en/en.txt.052.zst en/en.txt.053.zst en/en.txt.054.zst en/en.txt.055.zst en/en.txt.056.zst en/en.txt.057.zst en/en.txt.058.zst en/en.txt.059.zst en/en.txt.060.zst en/en.txt.061.zst en/en.txt.062.zst en/en.txt.063.zst en/en.txt.064.zst en/en.txt.065.zst en/en.txt.066.zst en/en.txt.067.zst en/en.txt.068.zst en/en.txt.069.zst en/en.txt.070.zst en/en.txt.071.zst en/en.txt.072.zst en/en.txt.073.zst en/en.txt.074.zst en/en.txt.075.zst en/en.txt.076.zst en/en.txt.077.zst en/en.txt.078.zst en/en.txt.079.zst en/en.txt.080.zst en/en.txt.081.zst en/en.txt.082.zst en/en.txt.083.zst en/en.txt.084.zst en/en.txt.085.zst en/en.txt.086.zst en/en.txt.087.zst en/en.txt.088.zst en/en.txt.089.zst en/en.txt.090.zst en/en.txt.091.zst en/en.txt.092.zst en/en.txt.093.zst en/en.txt.094.zst en/en.txt.095.zst en/en.txt.096.zst en/en.txt.097.zst en/en.txt.098.zst en/en.txt.099.zst en/en.txt.100.zst en/en.txt.101.zst en/en.txt.102.zst en/en.txt.103.zst en/en.txt.104.zst en/en.txt.105.zst en/en.txt.106.zst en/en.txt.107.zst en/en.txt.108.zst en/en.txt.109.zst en/en.txt.110.zst en/en.txt.111.zst en/en.txt.112.zst en/en.txt.113.zst en/en.txt.114.zst en/en.txt.115.zst en/en.txt.116.zst en/en.txt.117.zst en/en.txt.118.zst en/en.txt.119.zst en/en.txt.120.zst en/en.txt.121.zst en/en.txt.122.zst en/en.txt.123.zst en/en.txt.124.zst en/en.txt.125.zst en/en.txt.126.zst en/en.txt.127.zst en/en.txt.128.zst en/en.txt.129.zst en/en.txt.130.zst en/en.txt.131.zst en/en.txt.132.zst en/en.txt.133.zst en/en.txt.134.zst en/en.txt.135.zst en/en.txt.136.zst en/en.txt.137.zst en/en.txt.138.zst en/en.txt.139.zst en/en.txt.140.zst en/en.txt.141.zst en/en.txt.142.zst en/en.txt.143.zst en/en.txt.144.zst en/en.txt.145.zst en/en.txt.146.zst en/en.txt.147.zst en/en.txt.148.zst en/en.txt.149.zst en/en.txt.150.zst en/en.txt.151.zst en/en.txt.152.zst en/en.txt.153.zst en/en.txt.154.zst en/en.txt.155.zst en/en.txt.156.zst en/en.txt.157.zst en/en.txt.158.zst en/en.txt.159.zst en/en.txt.160.zst en/en.txt.161.zst en/en.txt.162.zst en/en.txt.163.zst en/en.txt.164.zst en/en.txt.165.zst en/en.txt.166.zst en/en.txt.167.zst en/en.txt.168.zst en/en.txt.169.zst en/en.txt.170.zst en/en.txt.171.zst en/en.txt.172.zst en/en.txt.173.zst en/en.txt.174.zst en/en.txt.175.zst en/en.txt.176.zst en/en.txt.177.zst en/en.txt.178.zst en/en.txt.179.zst en/en.txt.180.zst en/en.txt.181.zst en/en.txt.182.zst en/en.txt.183.zst en/en.txt.184.zst en/en.txt.185.zst en/en.txt.186.zst en/en.txt.187.zst en/en.txt.188.zst en/en.txt.189.zst en/en.txt.190.zst en/en.txt.191.zst en/en.txt.192.zst en/en.txt.193.zst en/en.txt.194.zst en/en.txt.195.zst en/en.txt.196.zst en/en.txt.197.zst en/en.txt.198.zst en/en.txt.199.zst en/en.txt.200.zst en/en.txt.201.zst en/en.txt.202.zst en/en.txt.203.zst en/en.txt.204.zst en/en.txt.205.zst en/en.txt.206.zst en/en.txt.207.zst en/en.txt.208.zst en/en.txt.209.zst en/en.txt.210.zst es/es.txt.000.zst es/es.txt.001.zst es/es.txt.002.zst es/es.txt.003.zst es/es.txt.004.zst es/es.txt.005.zst es/es.txt.006.zst es/es.txt.007.zst es/es.txt.008.zst es/es.txt.009.zst es/es.txt.010.zst es/es.txt.011.zst es/es.txt.012.zst es/es.txt.013.zst es/es.txt.014.zst es/es.txt.015.zst es/es.txt.016.zst es/es.txt.017.zst es/es.txt.018.zst es/es.txt.019.zst es/es.txt.020.zst es/es.txt.021.zst es/es.txt.022.zst es/es.txt.023.zst es/es.txt.024.zst es/es.txt.025.zst es/es.txt.026.zst es/es.txt.027.zst es/es.txt.028.zst es/es.txt.029.zst es/es.txt.030.zst es/es.txt.031.zst es/es.txt.032.zst es/es.txt.033.zst es/es.txt.034.zst es/es.txt.035.zst es/es.txt.036.zst es/es.txt.037.zst fr/fr.txt.000.zst fr/fr.txt.001.zst fr/fr.txt.002.zst fr/fr.txt.003.zst fr/fr.txt.004.zst fr/fr.txt.005.zst fr/fr.txt.006.zst fr/fr.txt.007.zst fr/fr.txt.008.zst fr/fr.txt.009.zst fr/fr.txt.010.zst fr/fr.txt.011.zst fr/fr.txt.012.zst fr/fr.txt.013.zst fr/fr.txt.014.zst fr/fr.txt.015.zst fr/fr.txt.016.zst fr/fr.txt.017.zst fr/fr.txt.018.zst fr/fr.txt.019.zst fr/fr.txt.020.zst fr/fr.txt.021.zst fr/fr.txt.022.zst fr/fr.txt.023.zst fr/fr.txt.024.zst fr/fr.txt.025.zst fr/fr.txt.026.zst fr/fr.txt.027.zst fr/fr.txt.028.zst fr/fr.txt.029.zst fr/fr.txt.030.zst fr/fr.txt.031.zst fr/fr.txt.032.zst fr/fr.txt.033.zst fr/fr.txt.034.zst fr/fr.txt.035.zst fr/fr.txt.036.zst fr/fr.txt.037.zst fr/fr.txt.038.zst fr/fr.txt.039.zst fr/fr.txt.040.zst fr/fr.txt.041.zst fr/fr.txt.042.zst hi/hi.txt.000.zst hi/hi.txt.001.zst hi/hi.txt.002.zst hi/hi.txt.003.zst hi/hi.txt.004.zst hi/hi.txt.005.zst hi/hi.txt.006.zst hi/hi.txt.007.zst hi/hi.txt.008.zst hi/hi.txt.009.zst hi/hi.txt.010.zst it/it.txt.000.zst it/it.txt.001.zst it/it.txt.002.zst it/it.txt.003.zst it/it.txt.004.zst it/it.txt.005.zst it/it.txt.006.zst it/it.txt.007.zst it/it.txt.008.zst it/it.txt.009.zst it/it.txt.010.zst it/it.txt.011.zst it/it.txt.012.zst it/it.txt.013.zst it/it.txt.014.zst it/it.txt.015.zst it/it.txt.016.zst it/it.txt.017.zst ja/ja.txt.000.zst ja/ja.txt.001.zst ja/ja.txt.002.zst ja/ja.txt.003.zst ja/ja.txt.004.zst ja/ja.txt.005.zst ja/ja.txt.006.zst ja/ja.txt.007.zst ja/ja.txt.008.zst ja/ja.txt.009.zst ja/ja.txt.010.zst ja/ja.txt.011.zst ja/ja.txt.012.zst ja/ja.txt.013.zst ja/ja.txt.014.zst ja/ja.txt.015.zst ja/ja.txt.016.zst ja/ja.txt.017.zst ja/ja.txt.018.zst ja/ja.txt.019.zst ja/ja.txt.020.zst ja/ja.txt.021.zst ja/ja.txt.022.zst ja/ja.txt.023.zst ja/ja.txt.024.zst ja/ja.txt.025.zst ja/ja.txt.026.zst ja/ja.txt.027.zst ja/ja.txt.028.zst ja/ja.txt.029.zst ja/ja.txt.030.zst ja/ja.txt.031.zst ja/ja.txt.032.zst ja/ja.txt.033.zst ja/ja.txt.034.zst ja/ja.txt.035.zst ja/ja.txt.036.zst ja/ja.txt.037.zst ja/ja.txt.038.zst ja/ja.txt.039.zst ja/ja.txt.040.zst ja/ja.txt.041.zst ja/ja.txt.042.zst ja/ja.txt.043.zst ja/ja.txt.044.zst ja/ja.txt.045.zst ko/ko.txt.000.zst ko/ko.txt.001.zst ko/ko.txt.002.zst ko/ko.txt.003.zst ko/ko.txt.004.zst ko/ko.txt.005.zst ko/ko.txt.006.zst ko/ko.txt.007.zst ko/ko.txt.008.zst ko/ko.txt.009.zst ko/ko.txt.010.zst ko/ko.txt.011.zst ko/ko.txt.012.zst ko/ko.txt.013.zst ko/ko.txt.014.zst ko/ko.txt.015.zst ko/ko.txt.016.zst ko/ko.txt.017.zst ko/ko.txt.018.zst ko/ko.txt.019.zst ko/ko.txt.020.zst ko/ko.txt.021.zst ko/ko.txt.022.zst ko/ko.txt.023.zst ko/ko.txt.024.zst ko/ko.txt.025.zst ko/ko.txt.026.zst ko/ko.txt.027.zst ko/ko.txt.028.zst ko/ko.txt.029.zst ko/ko.txt.030.zst ko/ko.txt.031.zst ko/ko.txt.032.zst ko/ko.txt.033.zst ko/ko.txt.034.zst ko/ko.txt.035.zst ko/ko.txt.036.zst ko/ko.txt.037.zst ko/ko.txt.038.zst ko/ko.txt.039.zst pt/pt.txt.000.zst pt/pt.txt.001.zst pt/pt.txt.002.zst pt/pt.txt.003.zst pt/pt.txt.004.zst pt/pt.txt.005.zst pt/pt.txt.006.zst pt/pt.txt.007.zst pt/pt.txt.008.zst pt/pt.txt.009.zst pt/pt.txt.010.zst pt/pt.txt.011.zst pt/pt.txt.012.zst pt/pt.txt.013.zst pt/pt.txt.014.zst pt/pt.txt.015.zst pt/pt.txt.016.zst pt/pt.txt.017.zst pt/pt.txt.018.zst pt/pt.txt.019.zst pt/pt.txt.020.zst pt/pt.txt.021.zst pt/pt.txt.022.zst pt/pt.txt.023.zst pt/pt.txt.024.zst pt/pt.txt.025.zst pt/pt.txt.026.zst pt/pt.txt.027.zst pt/pt.txt.028.zst pt/pt.txt.029.zst pt/pt.txt.030.zst pt/pt.txt.031.zst pt/pt.txt.032.zst pt/pt.txt.033.zst th/th.txt.000.zst th/th.txt.001.zst th/th.txt.002.zst th/th.txt.003.zst th/th.txt.004.zst th/th.txt.005.zst th/th.txt.006.zst th/th.txt.007.zst th/th.txt.008.zst th/th.txt.009.zst th/th.txt.010.zst th/th.txt.011.zst th/th.txt.012.zst th/th.txt.013.zst th/th.txt.014.zst th/th.txt.015.zst th/th.txt.016.zst th/th.txt.017.zst th/th.txt.018.zst th/th.txt.019.zst th/th.txt.020.zst th/th.txt.021.zst th/th.txt.022.zst th/th.txt.023.zst th/th.txt.024.zst th/th.txt.025.zst th/th.txt.026.zst th/th.txt.027.zst th/th.txt.028.zst th/th.txt.029.zst th/th.txt.030.zst th/th.txt.031.zst zh-Hans/zh-Hans.txt.000.zst zh-Hans/zh-Hans.txt.001.zst zh-Hans/zh-Hans.txt.002.zst zh-Hans/zh-Hans.txt.003.zst zh-Hans/zh-Hans.txt.004.zst zh-Hans/zh-Hans.txt.005.zst zh-Hans/zh-Hans.txt.006.zst zh-Hans/zh-Hans.txt.007.zst zh-Hans/zh-Hans.txt.008.zst zh-Hans/zh-Hans.txt.009.zst zh-Hans/zh-Hans.txt.010.zst zh-Hans/zh-Hans.txt.011.zst zh-Hans/zh-Hans.txt.012.zst zh-Hans/zh-Hans.txt.013.zst zh-Hans/zh-Hans.txt.014.zst zh-Hans/zh-Hans.txt.015.zst zh-Hans/zh-Hans.txt.016.zst zh-Hans/zh-Hans.txt.017.zst zh-Hans/zh-Hans.txt.018.zst zh-Hans/zh-Hans.txt.019.zst zh-Hans/zh-Hans.txt.020.zst zh-Hant/zh-Hant.txt.000.zst zh-Hant/zh-Hant.txt.001.zst zh-Hant/zh-Hant.txt.002.zst zh-Hant/zh-Hant.txt.003.zst zh-Hant/zh-Hant.txt.004.zst zh-Hant/zh-Hant.txt.005.zst zh-Hant/zh-Hant.txt.006.zst zh-Hant/zh-Hant.txt.007.zst zh-Hant/zh-Hant.txt.008.zst)

mkdir -p $(dirname ${SPLITS[$AWS_BATCH_JOB_ARRAY_INDEX]::-4})
aws s3 cp $BASE${SPLITS[$AWS_BATCH_JOB_ARRAY_INDEX]} - | zstd -d > ${SPLITS[$AWS_BATCH_JOB_ARRAY_INDEX]::-4}
python3 /usr/local/bin/prepare_quickthought.py --input ${SPLITS[$AWS_BATCH_JOB_ARRAY_INDEX]::-4} --output ${SPLITS[$AWS_BATCH_JOB_ARRAY_INDEX]::-4}.feather --max-seq-length $1
aws s3 cp ${SPLITS[$AWS_BATCH_JOB_ARRAY_INDEX]::-4}.feather s3://lausen-mstar-dev/batch/${AWS_BATCH_JOB_ID//:/\/}/${SPLITS[$AWS_BATCH_JOB_ARRAY_INDEX]::-4}.feather

